function Nt(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Z(){}function yt(n){return n()}function Ze(){return Object.create(null)}function we(n){n.forEach(yt)}function gt(n){return typeof n=="function"}function bt(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function Bt(n){return Object.keys(n).length===0}function $(n,e){n.appendChild(e)}function I(n,e,t){n.insertBefore(e,t||null)}function x(n){n.parentNode&&n.parentNode.removeChild(n)}function Ft(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function R(n){return document.createElement(n)}function W(n){return document.createTextNode(n)}function G(){return W(" ")}function Mt(){return W("")}function he(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function N(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Ht(n){return Array.from(n.childNodes)}function je(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function oe(n,e){n.value=e??""}let ye;function ve(n){ye=n}function Jt(){if(!ye)throw new Error("Function called outside component initialization");return ye}function zt(n){Jt().$$.on_mount.push(n)}const pe=[],et=[],$e=[],tt=[],qt=Promise.resolve();let Je=!1;function Gt(){Je||(Je=!0,qt.then(wt))}function ze(n){$e.push(n)}const Le=new Set;let Ee=0;function wt(){const n=ye;do{for(;Ee<pe.length;){const e=pe[Ee];Ee++,ve(e),Vt(e.$$)}for(ve(null),pe.length=0,Ee=0;et.length;)et.pop()();for(let e=0;e<$e.length;e+=1){const t=$e[e];Le.has(t)||(Le.add(t),t())}$e.length=0}while(pe.length);for(;tt.length;)tt.pop()();Je=!1,Le.clear(),ve(n)}function Vt(n){if(n.fragment!==null){n.update(),we(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(ze)}}const Se=new Set;let Wt;function Tt(n,e){n&&n.i&&(Se.delete(n),n.i(e))}function Kt(n,e,t,r){if(n&&n.o){if(Se.has(n))return;Se.add(n),Wt.c.push(()=>{Se.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}function Xt(n){n&&n.c()}function Et(n,e,t,r){const{fragment:i,after_update:s}=n.$$;i&&i.m(e,t),r||ze(()=>{const o=n.$$.on_mount.map(yt).filter(gt);n.$$.on_destroy?n.$$.on_destroy.push(...o):we(o),n.$$.on_mount=[]}),s.forEach(ze)}function Ot(n,e){const t=n.$$;t.fragment!==null&&(we(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Yt(n,e){n.$$.dirty[0]===-1&&(pe.push(n),Gt(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function kt(n,e,t,r,i,s,o,a=[-1]){const h=ye;ve(n);const l=n.$$={fragment:null,ctx:[],props:s,update:Z,not_equal:i,bound:Ze(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:Ze(),dirty:a,skip_bound:!1,root:e.target||h.$$.root};o&&o(l.root);let c=!1;if(l.ctx=t?t(n,e.props||{},(u,_,...v)=>{const p=v.length?v[0]:_;return l.ctx&&i(l.ctx[u],l.ctx[u]=p)&&(!l.skip_bound&&l.bound[u]&&l.bound[u](p),c&&Yt(n,u)),_}):[],l.update(),c=!0,we(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const u=Ht(e.target);l.fragment&&l.fragment.l(u),u.forEach(x)}else l.fragment&&l.fragment.c();e.intro&&Tt(n.$$.fragment),Et(n,e.target,e.anchor,e.customElement),wt()}ve(h)}class $t{$destroy(){Ot(this,1),this.$destroy=Z}$on(e,t){if(!gt(t))return Z;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Bt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Qt="modulepreload",Zt=function(n){return"/"+n},rt={},Ae=function(e,t,r){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=Zt(s),s in rt)return;rt[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let c=i.length-1;c>=0;c--){const u=i[c];if(u.href===s&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":Qt,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((c,u)=>{l.addEventListener("load",c),l.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};var er=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};const tr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>er(void 0,void 0,void 0,function*(){return yield(yield Ae(()=>Promise.resolve().then(()=>xe),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class We extends Error{constructor(e,t="FunctionsError",r){super(e),super.name=t,this.context=r}}class rr extends We{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class nr extends We{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ir extends We{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var sr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};class or{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=tr(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return sr(this,void 0,void 0,function*(){try{const{headers:i,body:s}=t;let o={},a;s&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",a=s):typeof s=="string"?(o["Content-Type"]="text/plain",a=s):typeof FormData<"u"&&s instanceof FormData?a=s:(o["Content-Type"]="application/json",a=JSON.stringify(s)));const h=yield this.fetch(`${this.url}/${e}`,{method:"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:a}).catch(_=>{throw new rr(_)}),l=h.headers.get("x-relay-error");if(l&&l==="true")throw new nr(h);if(!h.ok)throw new ir(h);let c=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),u;return c==="application/json"?u=yield h.json():c==="application/octet-stream"?u=yield h.blob():c==="multipart/form-data"?u=yield h.formData():u=yield h.text(),{data:u,error:null}}catch(i){return{data:null,error:i}}})}}var ar=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ge={exports:{}};(function(n,e){var t=typeof self<"u"?self:ar,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function h(d){return d&&DataView.prototype.isPrototypeOf(d)}if(a.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(d){return d&&l.indexOf(Object.prototype.toString.call(d))>-1};function u(d){if(typeof d!="string"&&(d=String(d)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(d))throw new TypeError("Invalid character in header field name");return d.toLowerCase()}function _(d){return typeof d!="string"&&(d=String(d)),d}function v(d){var f={next:function(){var g=d.shift();return{done:g===void 0,value:g}}};return a.iterable&&(f[Symbol.iterator]=function(){return f}),f}function p(d){this.map={},d instanceof p?d.forEach(function(f,g){this.append(g,f)},this):Array.isArray(d)?d.forEach(function(f){this.append(f[0],f[1])},this):d&&Object.getOwnPropertyNames(d).forEach(function(f){this.append(f,d[f])},this)}p.prototype.append=function(d,f){d=u(d),f=_(f);var g=this.map[d];this.map[d]=g?g+", "+f:f},p.prototype.delete=function(d){delete this.map[u(d)]},p.prototype.get=function(d){return d=u(d),this.has(d)?this.map[d]:null},p.prototype.has=function(d){return this.map.hasOwnProperty(u(d))},p.prototype.set=function(d,f){this.map[u(d)]=_(f)},p.prototype.forEach=function(d,f){for(var g in this.map)this.map.hasOwnProperty(g)&&d.call(f,this.map[g],g,this)},p.prototype.keys=function(){var d=[];return this.forEach(function(f,g){d.push(g)}),v(d)},p.prototype.values=function(){var d=[];return this.forEach(function(f){d.push(f)}),v(d)},p.prototype.entries=function(){var d=[];return this.forEach(function(f,g){d.push([g,f])}),v(d)},a.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function y(d){if(d.bodyUsed)return Promise.reject(new TypeError("Already read"));d.bodyUsed=!0}function m(d){return new Promise(function(f,g){d.onload=function(){f(d.result)},d.onerror=function(){g(d.error)}})}function S(d){var f=new FileReader,g=m(f);return f.readAsArrayBuffer(d),g}function F(d){var f=new FileReader,g=m(f);return f.readAsText(d),g}function H(d){for(var f=new Uint8Array(d),g=new Array(f.length),L=0;L<f.length;L++)g[L]=String.fromCharCode(f[L]);return g.join("")}function A(d){if(d.slice)return d.slice(0);var f=new Uint8Array(d.byteLength);return f.set(new Uint8Array(d)),f.buffer}function J(){return this.bodyUsed=!1,this._initBody=function(d){this._bodyInit=d,d?typeof d=="string"?this._bodyText=d:a.blob&&Blob.prototype.isPrototypeOf(d)?this._bodyBlob=d:a.formData&&FormData.prototype.isPrototypeOf(d)?this._bodyFormData=d:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)?this._bodyText=d.toString():a.arrayBuffer&&a.blob&&h(d)?(this._bodyArrayBuffer=A(d.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(d)||c(d))?this._bodyArrayBuffer=A(d):this._bodyText=d=Object.prototype.toString.call(d):this._bodyText="",this.headers.get("content-type")||(typeof d=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var d=y(this);if(d)return d;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(S)}),this.text=function(){var d=y(this);if(d)return d;if(this._bodyBlob)return F(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(H(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(U)}),this.json=function(){return this.text().then(JSON.parse)},this}var z=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Q(d){var f=d.toUpperCase();return z.indexOf(f)>-1?f:d}function j(d,f){f=f||{};var g=f.body;if(d instanceof j){if(d.bodyUsed)throw new TypeError("Already read");this.url=d.url,this.credentials=d.credentials,f.headers||(this.headers=new p(d.headers)),this.method=d.method,this.mode=d.mode,this.signal=d.signal,!g&&d._bodyInit!=null&&(g=d._bodyInit,d.bodyUsed=!0)}else this.url=String(d);if(this.credentials=f.credentials||this.credentials||"same-origin",(f.headers||!this.headers)&&(this.headers=new p(f.headers)),this.method=Q(f.method||this.method||"GET"),this.mode=f.mode||this.mode||null,this.signal=f.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&g)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(g)}j.prototype.clone=function(){return new j(this,{body:this._bodyInit})};function U(d){var f=new FormData;return d.trim().split("&").forEach(function(g){if(g){var L=g.split("="),D=L.shift().replace(/\+/g," "),E=L.join("=").replace(/\+/g," ");f.append(decodeURIComponent(D),decodeURIComponent(E))}}),f}function b(d){var f=new p,g=d.replace(/\r?\n[\t ]+/g," ");return g.split(/\r?\n/).forEach(function(L){var D=L.split(":"),E=D.shift().trim();if(E){var Te=D.join(":").trim();f.append(E,Te)}}),f}J.call(j.prototype);function P(d,f){f||(f={}),this.type="default",this.status=f.status===void 0?200:f.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in f?f.statusText:"OK",this.headers=new p(f.headers),this.url=f.url||"",this._initBody(d)}J.call(P.prototype),P.prototype.clone=function(){return new P(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},P.error=function(){var d=new P(null,{status:0,statusText:""});return d.type="error",d};var C=[301,302,303,307,308];P.redirect=function(d,f){if(C.indexOf(f)===-1)throw new RangeError("Invalid status code");return new P(null,{status:f,headers:{location:d}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(f,g){this.message=f,this.name=g;var L=Error(f);this.stack=L.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function se(d,f){return new Promise(function(g,L){var D=new j(d,f);if(D.signal&&D.signal.aborted)return L(new o.DOMException("Aborted","AbortError"));var E=new XMLHttpRequest;function Te(){E.abort()}E.onload=function(){var de={status:E.status,statusText:E.statusText,headers:b(E.getAllResponseHeaders()||"")};de.url="responseURL"in E?E.responseURL:de.headers.get("X-Request-URL");var Ue="response"in E?E.response:E.responseText;g(new P(Ue,de))},E.onerror=function(){L(new TypeError("Network request failed"))},E.ontimeout=function(){L(new TypeError("Network request failed"))},E.onabort=function(){L(new o.DOMException("Aborted","AbortError"))},E.open(D.method,D.url,!0),D.credentials==="include"?E.withCredentials=!0:D.credentials==="omit"&&(E.withCredentials=!1),"responseType"in E&&a.blob&&(E.responseType="blob"),D.headers.forEach(function(de,Ue){E.setRequestHeader(Ue,de)}),D.signal&&(D.signal.addEventListener("abort",Te),E.onreadystatechange=function(){E.readyState===4&&D.signal.removeEventListener("abort",Te)}),E.send(typeof D._bodyInit>"u"?null:D._bodyInit)})}return se.polyfill=!0,s.fetch||(s.fetch=se,s.Headers=p,s.Request=j,s.Response=P),o.Headers=p,o.Request=j,o.Response=P,o.fetch=se,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(ge,ge.exports);const Ke=lr(ge.exports),xe=Nt({__proto__:null,default:Ke},[ge.exports]);var cr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};class hr{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.allowEmpty=e.allowEmpty,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ke:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(s=>cr(this,void 0,void 0,function*(){var o,a,h;let l=null,c=null,u=null,_=s.status,v=s.statusText;if(s.ok){if(this.method!=="HEAD"){const S=yield s.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=S:c=JSON.parse(S))}const y=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),m=(a=s.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");y&&m&&m.length>1&&(u=parseInt(m[1]))}else{const y=yield s.text();try{l=JSON.parse(y)}catch{l={message:y}}if(l&&this.allowEmpty&&((h=l==null?void 0:l.details)===null||h===void 0?void 0:h.includes("Results contain 0 rows"))&&(l=null,_=200,v="OK"),l&&this.shouldThrowOnError)throw l}return{error:l,data:c,count:u,status:_,statusText:v}}));return this.shouldThrowOnError||(i=i.catch(s=>({error:{message:`FetchError: ${s.message}`,details:"",hint:"",code:s.code||""},data:null,count:null,status:0,statusText:""}))),i.then(e,t)}}class ur extends hr{select(e){let t=!1;const r=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:i}={}){const s=i?`${i}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const i=typeof r>"u"?"offset":`${r}.offset`,s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(s,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="application/vnd.pgrst.object+json",this.allowEmpty=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:i=!1,wal:s=!1,format:o="text"}={}){const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,i?"buffers":null,s?"wal":null].filter(Boolean).join("|"),h=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${h}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class ce extends ur{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:i}={}){let s="";i==="plain"?s="pl":i==="phrase"?s="ph":i==="websearch"&&(s="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class dr{constructor(e,{headers:t={},schema:r,fetch:i}){this.url=e,this.headers=t,this.schema=r,this.fetch=i}select(e,{head:t=!1,count:r}={}){const i=t?"HEAD":"GET";let s=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new ce({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t}={}){const r="POST",i=[],s=e;if(t&&i.push(`count=${t}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((a,h)=>a.concat(Object.keys(h)),[]);if(o.length>0){const a=[...new Set(o)].map(h=>`"${h}"`);this.url.searchParams.set("columns",a.join(","))}}return new ce({method:r,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:i}={}){const s="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];t!==void 0&&this.url.searchParams.set("on_conflict",t);const a=e;return i&&o.push(`count=${i}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new ce({method:s,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",i=[],s=e;return t&&i.push(`count=${t}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new ce({method:r,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ce({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const fr="1.1.0",pr={"X-Client-Info":`postgrest-js/${fr}`};class vr{constructor(e,{headers:t={},schema:r,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},pr),t),this.schema=r,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new dr(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:i}={}){let s;const o=new URL(`${this.url}/rpc/${e}`);let a;r?(s="HEAD",Object.entries(t).forEach(([l,c])=>{o.searchParams.append(l,`${c}`)})):(s="POST",a=t);const h=Object.assign({},this.headers);return i&&(h.Prefer=`count=${i}`),new ce({method:s,url:o,headers:h,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}}var Ne,nt;function _r(){if(nt)return Ne;nt=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return Ne=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),Ne}const mr="websocket",yr="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",gr=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],br="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",wr=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Tr="1.0.34",Er={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Or="https://github.com/theturtle32/WebSocket-Node",kr={node:">=4.0.0"},$r={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Sr={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},jr={verbose:!1},Rr={test:"tape test/unit/*.js",gulp:"gulp"},Ar="index",xr={lib:"./lib"},Pr="lib/browser.js",Cr="Apache-2.0",Ir={name:mr,description:yr,keywords:gr,author:br,contributors:wr,version:Tr,repository:Er,homepage:Or,engines:kr,dependencies:$r,devDependencies:Sr,config:jr,scripts:Rr,main:Ar,directories:xr,browser:Pr,license:Cr};var Dr=Ir.version,ee;if(typeof globalThis=="object")ee=globalThis;else try{ee=_r()}catch{}finally{if(!ee&&typeof window<"u"&&(ee=window),!ee)throw new Error("Could not determine global this")}var be=ee.WebSocket||ee.MozWebSocket,Ur=Dr;function St(n,e){var t;return e?t=new be(n,e):t=new be(n),t}be&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(St,n,{get:function(){return be[n]}})});var Lr={w3cwebsocket:be?St:null,version:Ur};const Nr="2.1.0",Br={"X-Client-Info":`realtime-js/${Nr}`},Fr="1.0.0",jt=1e4,Mr=1e3;var _e;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(_e||(_e={}));var M;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(M||(M={}));var V;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(V||(V={}));var qe;(function(n){n.websocket="websocket"})(qe||(qe={}));var te;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(te||(te={}));class Rt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Hr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),s=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+i));o=o+i;const h=r.decode(e.slice(o,o+s));o=o+s;const l=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:h,payload:l}}}class Be{constructor(e,t,r={},i=jt){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){!this.refEvent||this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var it;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(it||(it={}));class me{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=me.syncState(this.state,i,s,o),this.pendingDiffs.forEach(h=>{this.state=me.syncDiff(this.state,h,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=me.syncDiff(this.state,i,s,o),a())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const s=this.cloneDeep(e),o=this.transformState(t),a={},h={};return this.map(s,(l,c)=>{o[l]||(h[l]=c)}),this.map(o,(l,c)=>{const u=s[l];if(u){const _=c.map(m=>m.presence_ref),v=u.map(m=>m.presence_ref),p=c.filter(m=>v.indexOf(m.presence_ref)<0),y=u.filter(m=>_.indexOf(m.presence_ref)<0);p.length>0&&(a[l]=p),y.length>0&&(h[l]=y)}else a[l]=c}),this.syncDiff(s,{joins:a,leaves:h},r,i)}static syncDiff(e,t,r,i){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(s,(a,h)=>{var l;const c=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(h),c.length>0){const u=e[a].map(v=>v.presence_ref),_=c.filter(v=>u.indexOf(v.presence_ref)<0);e[a].unshift(..._)}r(a,c,h)}),this.map(o,(a,h)=>{let l=e[a];if(!l)return;const c=h.map(u=>u.presence_ref);l=l.filter(u=>c.indexOf(u.presence_ref)<0),e[a]=l,i(a,l,h),l.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var O;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(O||(O={}));const st=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,o)=>(s[o]=Jr(o,n,e,i),s),{})},Jr=(n,e,t,r)=>{const i=e.find(a=>a.name===n),s=i==null?void 0:i.type,o=t[n];return s&&!r.includes(s)?At(s,o):Ge(o)},At=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Vr(e,t)}switch(n){case O.bool:return zr(e);case O.float4:case O.float8:case O.int2:case O.int4:case O.int8:case O.numeric:case O.oid:return qr(e);case O.json:case O.jsonb:return Gr(e);case O.timestamp:return Wr(e);case O.abstime:case O.date:case O.daterange:case O.int4range:case O.int8range:case O.money:case O.reltime:case O.text:case O.time:case O.timestamptz:case O.timetz:case O.tsrange:case O.tstzrange:return Ge(e);default:return Ge(e)}},Ge=n=>n,zr=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},qr=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Gr=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Vr=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let s;const o=n.slice(1,t);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>At(e,a))}return n},Wr=n=>typeof n=="string"?n.replace(" ","T"):n;var ot=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})},at;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(at||(at={}));var lt;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(lt||(lt={}));var ct;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(ct||(ct={}));class Xe{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=M.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Be(this,V.join,this.params,this.timeout),this.rejoinTimer=new Rt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=M.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=M.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=M.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{!this._isJoining()||(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=M.errored,this.rejoinTimer.scheduleTimeout())}),this._on(V.reply,{},(i,s)=>{this._trigger(this._replyEventName(s),i)}),this.presence=new me(this)}subscribe(e,t=this.timeout){var r,i;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:s,presence:o}}=this.params;this._onError(l=>e&&e("CHANNEL_ERROR",l)),this._onClose(()=>e&&e("CLOSED"));const a={},h={broadcast:s,presence:o,postgres_changes:(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(l=>l.filter))!==null&&i!==void 0?i:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:h},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:l})=>{var c;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),l===void 0){e&&e("SUBSCRIBED");return}else{const u=this.bindings.postgres_changes,_=(c=u==null?void 0:u.length)!==null&&c!==void 0?c:0,v=[];for(let p=0;p<_;p++){const y=u[p],{filter:{event:m,schema:S,table:F,filter:H}}=y,A=l&&l[p];if(A&&A.event===m&&A.schema===S&&A.table===F&&A.filter===H)v.push(Object.assign(Object.assign({},y),{id:A.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e("SUBSCRIBED");return}}).receive("error",l=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return ot(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return ot(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var i,s,o;const a=this._push(e.type,e,t.timeout||this.timeout);a.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((o=(s=(i=this.params)===null||i===void 0?void 0:i.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.ack)&&r("ok"),a.receive("ok",()=>r("ok")),a.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=M.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(V.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const i=new Be(this,V.leave,{},e);i.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Be(this,e,t,r);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,s;const o=e.toLocaleLowerCase(),{close:a,error:h,leave:l,join:c}=V;if(r&&[a,h,l,c].indexOf(o)>=0&&r!==this._joinRef())return;let _=this._onMessage(o,t,r);if(t&&!_)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(v=>{var p,y,m;return((p=v.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(y=v.filter)===null||y===void 0?void 0:y.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(v=>v.callback(_,r)):(s=this.bindings[o])===null||s===void 0||s.filter(v=>{var p,y,m,S,F,H;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in v){const A=v.id,J=(p=v.filter)===null||p===void 0?void 0:p.event;return A&&((y=t.ids)===null||y===void 0?void 0:y.includes(A))&&(J==="*"||(J==null?void 0:J.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const A=(F=(S=v==null?void 0:v.filter)===null||S===void 0?void 0:S.event)===null||F===void 0?void 0:F.toLocaleLowerCase();return A==="*"||A===((H=t==null?void 0:t.event)===null||H===void 0?void 0:H.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===o}).map(v=>{if(typeof _=="object"&&"ids"in _){const p=_.data,{schema:y,table:m,commit_timestamp:S,type:F,errors:H}=p;_=Object.assign(Object.assign({},{schema:y,table:m,commit_timestamp:S,eventType:F,new:{},old:{},errors:H}),this._getPayloadRecords(p))}v.callback(_,r)})}_isClosed(){return this.state===M.closed}_isJoined(){return this.state===M.joined}_isJoining(){return this.state===M.joining}_isLeaving(){return this.state===M.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),s={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&Xe.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(V.close,{},e)}_onError(e){this._on(V.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=M.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=st(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=st(e.columns,e.old_record)),t}}var Kr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};const Xr=()=>{};class Yr{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Br,this.params={},this.timeout=jt,this.transport=Lr.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Xr,this.conn=null,this.sendBuffer=[],this.serializer=new Hr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${qe.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;i&&(this.eventsPerSecondLimitMs=Math.floor(1e3/i)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(s,o)=>o(JSON.stringify(s)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Rt(()=>Kr(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return e.unsubscribe().then(t=>(this.channels.length===0&&this.disconnect(),t))}removeAllChannels(){return Promise.all(this.channels.map(e=>e.unsubscribe())).then(e=>(this.disconnect(),e))}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case _e.connecting:return te.Connecting;case _e.open:return te.Open;case _e.closing:return te.Closing;default:return te.Closed}}isConnected(){return this.connectionState()===te.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new Xe(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:i,ref:s}=e;let o=()=>{this.encode(e,a=>{var h;(h=this.conn)===null||h===void 0||h.send(a)})};if(this.log("push",`${t} ${r} (${s})`,i),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(V.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Fr}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:i,payload:s,ref:o}=t;(o&&o===this.pendingHeartbeatRef||i===(s==null?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${i} ${o&&"("+o+")"||""}`,s),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(i,s,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(V.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(!!this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Mr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t),!1)}}class xt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function B(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Qr extends xt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Zr extends xt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Pt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};const Ct=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Pt(void 0,void 0,void 0,function*(){return yield(yield Ae(()=>Promise.resolve().then(()=>xe),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},en=()=>Pt(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ae(()=>Promise.resolve().then(()=>xe),void 0)).Response:Response});var ue=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};const ht=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),tn=(n,e)=>ue(void 0,void 0,void 0,function*(){const t=yield en();n instanceof t?n.json().then(r=>{e(new Qr(ht(r),n.status||500))}):e(new Zr(ht(n),n))}),rn=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};function Pe(n,e,t,r,i,s){return ue(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,rn(e,r,i,s)).then(h=>{if(!h.ok)throw h;return r!=null&&r.noResolveJson?h:h.json()}).then(h=>o(h)).catch(h=>tn(h,a))})})}function Ve(n,e,t,r){return ue(this,void 0,void 0,function*(){return Pe(n,"GET",e,t,r)})}function re(n,e,t,r,i){return ue(this,void 0,void 0,function*(){return Pe(n,"POST",e,r,i,t)})}function nn(n,e,t,r,i){return ue(this,void 0,void 0,function*(){return Pe(n,"PUT",e,r,i,t)})}function It(n,e,t,r,i){return ue(this,void 0,void 0,function*(){return Pe(n,"DELETE",e,r,i,t)})}var K=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};const sn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},on={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class an{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Ct(i)}uploadOrUpdate(e,t,r,i){return K(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},on),i),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",o.cacheControl)):(s=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const h=this._removeEmptyFolders(t),l=this._getFinalPath(h),c=yield this.fetch(`${this.url}/object/${l}`,{method:e,body:s,headers:a});return c.ok?{data:{path:h},error:null}:{data:null,error:yield c.json()}}catch(s){if(B(s))return{data:null,error:s};throw s}})}upload(e,t,r){return K(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}update(e,t,r){return K(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return K(this,void 0,void 0,function*(){try{return{data:yield re(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}copy(e,t){return K(this,void 0,void 0,function*(){try{return{data:{path:(yield re(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return K(this,void 0,void 0,function*(){try{const i=this._getFinalPath(e);let s=yield re(this.fetch,`${this.url}/object/sign/${i}`,{expiresIn:t},{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(i){if(B(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return K(this,void 0,void 0,function*(){try{const i=yield re(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(i){if(B(i))return{data:null,error:i};throw i}})}download(e){return K(this,void 0,void 0,function*(){try{const t=this._getFinalPath(e);return{data:yield(yield Ve(this.fetch,`${this.url}/object/${t}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=t!=null&&t.download?`?download=${t.download===!0?"":t.download}`:"";return{data:{publicUrl:encodeURI(`${this.url}/object/public/${r}${i}`)}}}remove(e){return K(this,void 0,void 0,function*(){try{return{data:yield It(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}list(e,t,r){return K(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},sn),t),{prefix:e||""});return{data:yield re(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(B(i))return{data:null,error:i};throw i}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}}const ln="2.0.0",cn={"X-Client-Info":`storage-js/${ln}`};var ae=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};class hn{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},cn),t),this.fetch=Ct(r)}listBuckets(){return ae(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}getBucket(e){return ae(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ae(this,void 0,void 0,function*(){try{return{data:yield re(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ae(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ae(this,void 0,void 0,function*(){try{return{data:yield re(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ae(this,void 0,void 0,function*(){try{return{data:yield It(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}}class un extends hn{constructor(e,t={},r){super(e,t,r)}from(e){return new an(this.url,this.headers,e,this.fetch)}}const dn="2.1.3",fn={"X-Client-Info":`supabase-js/${dn}`};var pn=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};const vn=n=>{let e;return n?e=n:typeof fetch>"u"?e=Ke:e=fetch,(...t)=>e(...t)},_n=()=>typeof Headers>"u"?ge.exports.Headers:Headers,mn=(n,e,t)=>{const r=vn(t),i=_n();return(s,o)=>pn(void 0,void 0,void 0,function*(){var a;const h=(a=yield e())!==null&&a!==void 0?a:n;let l=new i(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${h}`),r(s,Object.assign(Object.assign({},o),{headers:l}))})};function yn(n){return n.replace(/\/$/,"")}function gn(n,e){const{db:t,auth:r,realtime:i,global:s}=n,{db:o,auth:a,realtime:h,global:l}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},h),i),global:Object.assign(Object.assign({},l),s)}}var Ce=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};function bn(n){return Math.round(Date.now()/1e3)+n}function wn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const ie=()=>typeof window<"u";function q(n,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),n=n.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}const Dt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ce(void 0,void 0,void 0,function*(){return yield(yield Ae(()=>Promise.resolve().then(()=>xe),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},Tn=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",En=(n,e,t)=>Ce(void 0,void 0,void 0,function*(){yield n.setItem(e,JSON.stringify(t))}),ut=(n,e)=>Ce(void 0,void 0,void 0,function*(){const t=yield n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),On=(n,e)=>Ce(void 0,void 0,void 0,function*(){yield n.removeItem(e)}),kn=n=>{try{return decodeURIComponent(atob(n.replace(/[-]/g,"+").replace(/[_]/g,"/")).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(e){if(e instanceof ReferenceError)return Buffer.from(n,"base64").toString("utf-8");throw e}};class Ie{constructor(){this.promise=new Ie.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ie.promiseConstructor=Promise;function dt(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(kn(r))}class Ye extends Error{constructor(e){super(e),this.__isAuthError=!0,this.name="AuthError"}}function T(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class $n extends Ye{constructor(e,t){super(e),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Sn(n){return T(n)&&n.name==="AuthApiError"}class Ut extends Ye{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class De extends Ye{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class fe extends De{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Fe extends De{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Y extends De{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Re extends De{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}var Qe=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})},jn=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const Oe=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Rn=(n,e)=>Qe(void 0,void 0,void 0,function*(){const t=[502,503,504];Tn(n)?t.includes(n.status)?e(new Re(Oe(n),n.status)):n.json().then(r=>{e(new $n(Oe(r),n.status||500))}).catch(r=>{e(new Ut(Oe(r),r))}):e(new Re(Oe(n),0))}),An=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};function k(n,e,t,r){var i;return Qe(this,void 0,void 0,function*(){const s=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const o=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=yield xn(n,e,t+a,{headers:s,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(h):{data:Object.assign({},h),error:null}})}function xn(n,e,t,r,i,s){return Qe(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,An(e,r,i,s)).then(h=>{if(!h.ok)throw h;return r!=null&&r.noResolveJson?h:h.json()}).then(h=>o(h)).catch(h=>Rn(h,a))})})}function le(n){var e;let t=null;In(n)&&(t=Object.assign({},n),t.expires_at=bn(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function ne(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Pn(n){return{data:n,error:null}}function Cn(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s}=n,o=jn(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s},h=Object.assign({},o);return{data:{properties:a,user:h},error:null}}function In(n){return n.access_token&&n.refresh_token&&n.expires_in}var X=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})},Dn=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class Un{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Dt(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e){return X(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/logout`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}inviteUserByEmail(e,t={}){return X(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ne})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}generateLink(e){return X(this,void 0,void 0,function*(){try{const{options:t}=e,r=Dn(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),yield k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Cn,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(T(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return X(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ne})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}listUsers(){return X(this,void 0,void 0,function*(){try{const{data:e,error:t}=yield k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers});if(t)throw t;return{data:Object.assign({},e),error:null}}catch(e){if(T(e))return{data:{users:[]},error:e};throw e}})}getUserById(e){return X(this,void 0,void 0,function*(){try{return yield k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ne})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return X(this,void 0,void 0,function*(){try{return yield k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ne})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}deleteUser(e){return X(this,void 0,void 0,function*(){try{return yield k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ne})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}_listFactors(e){return X(this,void 0,void 0,function*(){try{return{data:yield k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return X(this,void 0,void 0,function*(){try{return{data:yield k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}}const Ln="2.4.3",Nn="http://localhost:9999",Bn="supabase.auth.token",Fn={"X-Client-Info":`gotrue-js/${Ln}`},Me=10,ke={MAX_RETRIES:10,RETRY_INTERVAL:2},Mn={getItem:n=>ie()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{!ie()||globalThis.localStorage.setItem(n,e)},removeItem:n=>{!ie()||globalThis.localStorage.removeItem(n)}};function Hn(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var w=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};Hn();const Jn={url:Nn,storageKey:Bn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Fn};class zn{constructor(e){this.stateChangeEmitters=new Map,this.networkRetries=0,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0;const t=Object.assign(Object.assign({},Jn),e);this.inMemorySession=null,this.storageKey=t.storageKey,this.autoRefreshToken=t.autoRefreshToken,this.persistSession=t.persistSession,this.storage=t.storage||Mn,this.admin=new Un({url:t.url,headers:t.headers,fetch:t.fetch}),this.url=t.url,this.headers=t.headers,this.fetch=Dt(t.fetch),this.detectSessionInUrl=t.detectSessionInUrl,this.initialize(),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)}}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}_initialize(){return w(this,void 0,void 0,function*(){if(this.initializePromise)return this.initializePromise;try{if(this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:e,error:t}=yield this._getSessionFromUrl();if(t)return yield this._removeSession(),{error:t};const{session:r,redirectType:i}=e;return yield this._saveSession(r),this._notifyAllSubscribers("SIGNED_IN",r),i==="recovery"&&this._notifyAllSubscribers("PASSWORD_RECOVERY",r),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return T(e)?{error:e}:{error:new Ut("Unexpected error during initialization",e)}}finally{this._handleVisibilityChange()}})}signUp(e){var t,r;return w(this,void 0,void 0,function*(){try{yield this._removeSession();let i;if("email"in e){const{email:l,password:c,options:u}=e;i=yield k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:u==null?void 0:u.emailRedirectTo,body:{email:l,password:c,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:le})}else if("phone"in e){const{phone:l,password:c,options:u}=e;i=yield k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:c,data:(r=u==null?void 0:u.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:le})}else throw new Fe("You must provide either an email or phone number and a password");const{data:s,error:o}=i;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,h=s.user;return s.session&&(yield this._saveSession(s.session),this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(e){var t,r;return w(this,void 0,void 0,function*(){try{yield this._removeSession();let i;if("email"in e){const{email:a,password:h,options:l}=e;i=yield k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:h,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:le})}else if("phone"in e){const{phone:a,password:h,options:l}=e;i=yield k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:h,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:le})}else throw new Fe("You must provide either an email or phone number and a password");const{data:s,error:o}=i;return o||!s?{data:{user:null,session:null},error:o}:(s.session&&(yield this._saveSession(s.session),this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:s,error:o})}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithOAuth(e){var t,r,i;return w(this,void 0,void 0,function*(){return yield this._removeSession(),this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams})})}signInWithOtp(e){var t,r,i,s;return w(this,void 0,void 0,function*(){try{if(yield this._removeSession(),"email"in e){const{email:o,options:a}=e,{error:h}=yield k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(r=a==null?void 0:a.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:a}=e,{error:h}=yield k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=a==null?void 0:a.data)!==null&&i!==void 0?i:{},create_user:(s=a==null?void 0:a.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}}});return{data:{user:null,session:null},error:h}}throw new Fe("You must provide either an email or phone number.")}catch(o){if(T(o))return{data:{user:null,session:null},error:o};throw o}})}verifyOtp(e){var t,r;return w(this,void 0,void 0,function*(){try{yield this._removeSession();const{data:i,error:s}=yield k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:le});if(s)throw s;if(!i)throw"An error occurred on token verification.";const o=i.session,a=i.user;return o!=null&&o.access_token&&(yield this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:a,session:o},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithSSO(e){var t,r,i;return w(this,void 0,void 0,function*(){try{return yield this._removeSession(),yield k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:Pn})}catch(s){if(T(s))return{data:null,error:s};throw s}})}getSession(){return w(this,void 0,void 0,function*(){yield this.initializePromise;let e=null;if(this.persistSession){const s=yield ut(this.storage,this.storageKey);s!==null&&(this._isValidSession(s)?e=s:yield this._removeSession())}else e=this.inMemorySession;if(!e)return{data:{session:null},error:null};if(!(e.expires_at?e.expires_at<=Date.now()/1e3:!1))return{data:{session:e},error:null};const{session:r,error:i}=yield this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}})}getUser(e){var t,r;return w(this,void 0,void 0,function*(){try{if(!e){const{data:i,error:s}=yield this.getSession();if(s)throw s;e=(r=(t=i.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return yield k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ne})}catch(i){if(T(i))return{data:{user:null},error:i};throw i}})}updateUser(e){return w(this,void 0,void 0,function*(){try{const{data:t,error:r}=yield this.getSession();if(r)throw r;if(!t.session)throw new fe;const i=t.session,{data:s,error:o}=yield k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,body:e,jwt:i.access_token,xform:ne});if(o)throw o;return i.user=s.user,yield this._saveSession(i),this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}_decodeJWT(e){return dt(e)}setSession(e){return w(this,void 0,void 0,function*(){try{if(!e.access_token||!e.refresh_token)throw new fe;const t=Date.now()/1e3;let r=t,i=!0,s=null;const o=dt(e.access_token);if(o.exp&&(r=o.exp,i=r<=t),i){const{session:a,error:h}=yield this._callRefreshToken(e.refresh_token);if(h)return{data:{user:null,session:null},error:h};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:h}=yield this.getUser(e.access_token);if(h)throw h;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){var t;return w(this,void 0,void 0,function*(){try{if(!e){const{data:s,error:o}=yield this.getSession();if(o)throw o;e=(t=s.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new fe;const{session:r,error:i}=yield this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(T(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromUrl(){return w(this,void 0,void 0,function*(){try{if(!ie())throw new Y("No browser detected.");if(!this._isImplicitGrantFlow())throw new Y("Not a valid implicit grant flow url.");const e=q("error_description");if(e){const y=q("error_code");if(!y)throw new Y("No error_code detected.");const m=q("error");throw m?new Y(e,{error:m,code:y}):new Y("No error detected.")}const t=q("provider_token"),r=q("provider_refresh_token"),i=q("access_token");if(!i)throw new Y("No access_token detected.");const s=q("expires_in");if(!s)throw new Y("No expires_in detected.");const o=q("refresh_token");if(!o)throw new Y("No refresh_token detected.");const a=q("token_type");if(!a)throw new Y("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(s),{data:c,error:u}=yield this.getUser(i);if(u)throw u;const _=c.user,v={provider_token:t,provider_refresh_token:r,access_token:i,expires_in:parseInt(s),expires_at:l,refresh_token:o,token_type:a,user:_},p=q("type");return window.location.hash="",{data:{session:v,redirectType:p},error:null}}catch(e){if(T(e))return{data:{session:null,redirectType:null},error:e};throw e}})}_isImplicitGrantFlow(){return ie()&&(Boolean(q("access_token"))||Boolean(q("error_description")))}signOut(){var e;return w(this,void 0,void 0,function*(){const{data:t,error:r}=yield this.getSession();if(r)return{error:r};const i=(e=t.session)===null||e===void 0?void 0:e.access_token;if(i){const{error:s}=yield this.admin.signOut(i);if(s&&!(Sn(s)&&(s.status===404||s.status===401)))return{error:s}}return yield this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT",null),{error:null}})}onAuthStateChange(e){const t=wn(),r={id:t,callback:e,unsubscribe:()=>{this.stateChangeEmitters.delete(t)}};return this.stateChangeEmitters.set(t,r),{data:{subscription:r}}}resetPasswordForEmail(e,t={}){return w(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(T(r))return{data:null,error:r};throw r}})}_refreshAccessToken(e){return w(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:le})}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t={}){const r=this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return ie()&&(window.location.href=r),{data:{provider:e,url:r},error:null}}_recoverAndRefresh(){var e;return w(this,void 0,void 0,function*(){try{const t=yield ut(this.storage,this.storageKey);if(!this._isValidSession(t)){t!==null&&(yield this._removeSession());return}const r=Math.round(Date.now()/1e3);if(((e=t.expires_at)!==null&&e!==void 0?e:1/0)<r+Me)if(this.autoRefreshToken&&t.refresh_token){this.networkRetries++;const{error:i}=yield this._callRefreshToken(t.refresh_token);if(i){if(console.log(i.message),i instanceof Re&&this.networkRetries<ke.MAX_RETRIES){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),this.refreshTokenTimer=setTimeout(()=>this._recoverAndRefresh(),Math.pow(ke.RETRY_INTERVAL,this.networkRetries)*100);return}yield this._removeSession()}this.networkRetries=0}else yield this._removeSession();else this.persistSession&&(yield this._saveSession(t)),this._notifyAllSubscribers("SIGNED_IN",t)}catch(t){console.error(t);return}})}_callRefreshToken(e){var t,r;return w(this,void 0,void 0,function*(){if(this.refreshingDeferred)return this.refreshingDeferred.promise;try{if(this.refreshingDeferred=new Ie,!e)throw new fe;const{data:i,error:s}=yield this._refreshAccessToken(e);if(s)throw s;if(!i.session)throw new fe;yield this._saveSession(i.session),this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(T(i)){const s={session:null,error:i};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(s),s}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null}})}_notifyAllSubscribers(e,t){this.stateChangeEmitters.forEach(r=>r.callback(e,t))}_saveSession(e){return w(this,void 0,void 0,function*(){this.persistSession||(this.inMemorySession=e);const t=e.expires_at;if(t){const r=Math.round(Date.now()/1e3),i=t-r,s=i>Me?Me:.5;this._startAutoRefreshToken((i-s)*1e3)}this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return En(this.storage,this.storageKey,e)}_removeSession(){return w(this,void 0,void 0,function*(){this.persistSession?yield On(this.storage,this.storageKey):this.inMemorySession=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer)})}_startAutoRefreshToken(e){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),!(e<=0||!this.autoRefreshToken)&&(this.refreshTokenTimer=setTimeout(()=>w(this,void 0,void 0,function*(){this.networkRetries++;const{data:{session:t},error:r}=yield this.getSession();if(!r&&t){const{error:i}=yield this._callRefreshToken(t.refresh_token);i||(this.networkRetries=0),i instanceof Re&&this.networkRetries<ke.MAX_RETRIES&&this._startAutoRefreshToken(Math.pow(ke.RETRY_INTERVAL,this.networkRetries)*100)}}),e),typeof this.refreshTokenTimer.unref=="function"&&this.refreshTokenTimer.unref())}_handleVisibilityChange(){if(!ie()||!(window!=null&&window.addEventListener))return!1;try{window==null||window.addEventListener("visibilitychange",()=>w(this,void 0,void 0,function*(){document.visibilityState==="visible"&&(yield this.initializePromise,yield this._recoverAndRefresh())}))}catch(e){console.error("_handleVisibilityChange",e)}}_getUrlForProvider(e,t){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),t!=null&&t.queryParams){const i=new URLSearchParams(t.queryParams);r.push(i.toString())}return`${this.url}/authorize?${r.join("&")}`}_unenroll(e){var t;return w(this,void 0,void 0,function*(){try{const{data:r,error:i}=yield this.getSession();return i?{data:null,error:i}:yield k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(T(r))return{data:null,error:r};throw r}})}_enroll(e){var t,r;return w(this,void 0,void 0,function*(){try{const{data:i,error:s}=yield this.getSession();if(s)return{data:null,error:s};const{data:o,error:a}=yield k(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=i==null?void 0:i.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(!((r=o==null?void 0:o.totp)===null||r===void 0)&&r.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}catch(i){if(T(i))return{data:null,error:i};throw i}})}_verify(e){var t;return w(this,void 0,void 0,function*(){try{const{data:r,error:i}=yield this.getSession();if(i)return{data:null,error:i};const{data:s,error:o}=yield k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),{data:s,error:o})}catch(r){if(T(r))return{data:null,error:r};throw r}})}_challenge(e){var t;return w(this,void 0,void 0,function*(){try{const{data:r,error:i}=yield this.getSession();return i?{data:null,error:i}:yield k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(T(r))return{data:null,error:r};throw r}})}_challengeAndVerify(e){return w(this,void 0,void 0,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return w(this,void 0,void 0,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],i=r.filter(s=>s.factor_type==="totp"&&s.status==="verified");return{data:{all:r,totp:i},error:null}})}_getAuthenticatorAssuranceLevel(){var e,t;return w(this,void 0,void 0,function*(){const{data:{session:r},error:i}=yield this.getSession();if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const s=this._decodeJWT(r.access_token);let o=null;s.aal&&(o=s.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(c=>c.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const l=s.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:l},error:null}})}}class qn extends zn{constructor(e){super(e)}}var Gn=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(u){o(u)}}function h(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):i(c.value).then(a,h)}l((r=r.apply(n,e||[])).next())})};const Vn={headers:fn},Wn={schema:"public"},Kn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},Xn={};class Yn{constructor(e,t,r){var i,s,o,a,h,l,c,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const _=yn(e);if(this.realtimeUrl=`${_}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${_}/auth/v1`,this.storageUrl=`${_}/storage/v1`,_.match(/(supabase\.co)|(supabase\.in)/)){const S=_.split(".");this.functionsUrl=`${S[0]}.functions.${S[1]}.${S[2]}`}else this.functionsUrl=`${_}/functions/v1`;const p=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,y={db:Wn,realtime:Xn,auth:Object.assign(Object.assign({},Kn),{storageKey:p}),global:Vn},m=gn(r??{},y);this.storageKey=(s=(i=m.auth)===null||i===void 0?void 0:i.storageKey)!==null&&s!==void 0?s:"",this.headers=(a=(o=m.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((h=m.auth)!==null&&h!==void 0?h:{},this.headers,(l=m.global)===null||l===void 0?void 0:l.fetch),this.fetch=mn(t,this._getAccessToken.bind(this),(c=m.global)===null||c===void 0?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},m.realtime)),this.rest=new vr(`${_}/rest/v1`,{headers:this.headers,schema:(u=m.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new or(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new un(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Gn(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:s},o,a){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new qn({url:this.authUrl,headers:Object.assign(Object.assign({},h),o),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,fetch:a})}_initRealtimeClient(e){return new Yr(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,r==null?void 0:r.access_token,"CLIENT")})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==t?(this.realtime.setAuth(t??null),this.changedAccessToken=t):(e==="SIGNED_OUT"||e==="USER_DELETED")&&(this.realtime.setAuth(this.supabaseKey),r=="STORAGE"&&this.auth.signOut())}}const Qn=(n,e,t)=>new Yn(n,e,t),He=Qn("https://jnshrvuikrxdxpdiliwm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impuc2hydnVpa3J4ZHhwZGlsaXdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NzA3MDY2NDYsImV4cCI6MTk4NjI4MjY0Nn0.n3F3n8bEJgzmmvXnEk3MlexpK3XhtcP9TELDQTGlIbI");function Zn(n){let e;return{c(){e=R("main"),e.innerHTML=`<h1 class="svelte-4pul9f">Tuscarora State of Code 2022-2023</h1> 
    <b><p>A yearly coding survey for<br/>
        Tuscarora High School</p></b>`,N(e,"class","svelte-4pul9f")},m(t,r){I(t,e,r)},p:Z,i:Z,o:Z,d(t){t&&x(e)}}}class ei extends $t{constructor(e){super(),kt(this,e,null,Zn,bt,{})}}function ft(n,e,t){const r=n.slice();return r[11]=e[t],r[13]=t,r}function ti(n){let e,t,r;return{c(){e=R("h1"),e.textContent="Thank You for Participating!",t=G(),r=R("h3"),r.textContent="Results Coming Soon!"},m(i,s){I(i,e,s),I(i,t,s),I(i,r,s)},p:Z,d(i){i&&x(e),i&&x(t),i&&x(r)}}}function ri(n){let e,t,r,i,s,o,a,h,l,c,u,_,v;return{c(){e=R("form"),t=R("input"),r=G(),i=R("input"),s=R("br"),o=G(),a=R("input"),h=R("br"),l=R("br"),c=G(),u=R("input"),N(t,"type","text"),N(t,"placeholder","FirstName"),N(t,"class","svelte-o5metn"),N(i,"type","text"),N(i,"placeholder","Language"),N(i,"class","svelte-o5metn"),N(a,"type","text"),N(a,"placeholder","Where did you learn?"),N(a,"class","svelte-o5metn"),N(u,"type","submit"),u.value="Submit!",N(u,"class","svelte-o5metn")},m(p,y){I(p,e,y),$(e,t),oe(t,n[1]),$(e,r),$(e,i),oe(i,n[2]),$(e,s),$(e,o),$(e,a),oe(a,n[3]),$(e,h),$(e,l),$(e,c),$(e,u),_||(v=[he(t,"input",n[8]),he(i,"input",n[9]),he(a,"input",n[10]),he(u,"click",n[6])],_=!0)},p(p,y){y&2&&t.value!==p[1]&&oe(t,p[1]),y&4&&i.value!==p[2]&&oe(i,p[2]),y&8&&a.value!==p[3]&&oe(a,p[3])},d(p){p&&x(e),_=!1,we(v)}}}function ni(n){let e=n[11].firstName+"",t,r,i=n[11].language+"",s,o,a=n[13]<n[0].length-1&&pt();return{c(){t=W(e),r=W(" codes in "),s=W(i),a&&a.c(),o=R("br")},m(h,l){I(h,t,l),I(h,r,l),I(h,s,l),a&&a.m(h,l),I(h,o,l)},p(h,l){l&1&&e!==(e=h[11].firstName+"")&&je(t,e),l&1&&i!==(i=h[11].language+"")&&je(s,i),h[13]<h[0].length-1?a||(a=pt(),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},d(h){h&&x(t),h&&x(r),h&&x(s),a&&a.d(h),h&&x(o)}}}function ii(n){let e=n[11].firstName+"",t,r,i=n[11].language+"",s,o,a=n[13]<n[0].length-1&&vt();return{c(){t=W(e),r=W(" codes in "),s=W(i),a&&a.c(),o=W(" ")},m(h,l){I(h,t,l),I(h,r,l),I(h,s,l),a&&a.m(h,l),I(h,o,l)},p(h,l){l&1&&e!==(e=h[11].firstName+"")&&je(t,e),l&1&&i!==(i=h[11].language+"")&&je(s,i),h[13]<h[0].length-1?a||(a=vt(),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},d(h){h&&x(t),h&&x(r),h&&x(s),a&&a.d(h),h&&x(o)}}}function pt(n){let e;return{c(){e=W(",")},m(t,r){I(t,e,r)},d(t){t&&x(e)}}}function vt(n){let e;return{c(){e=W(",")},m(t,r){I(t,e,r)},d(t){t&&x(e)}}}function _t(n){let e;function t(s,o){return s[13]==0||li(s[13])==0?ii:ni}let i=t(n)(n);return{c(){i.c(),e=Mt()},m(s,o){i.m(s,o),I(s,e,o)},p(s,o){i.p(s,o)},d(s){i.d(s),s&&x(e)}}}function mt(n){let e,t,r;return{c(){e=R("button"),e.textContent="Delete all Cookies"},m(i,s){I(i,e,s),t||(r=he(e,"click",ci),t=!0)},p:Z,d(i){i&&x(e),t=!1,r()}}}function si(n){let e,t,r,i,s,o,a,h,l,c,u,_,v,p,y,m,S,F,H;t=new ei({});function A(b,P){return b[4]?ti:ri}let J=A(n),z=J(n),Q=n[0],j=[];for(let b=0;b<Q.length;b+=1)j[b]=_t(ft(n,Q,b));let U=n[5]=="bunsesIsCool!"&&mt();return{c(){e=R("main"),Xt(t.$$.fragment),r=G(),z.c(),i=G(),s=R("h3"),s.textContent="Language use Results",o=G();for(let b=0;b<j.length;b+=1)j[b].c();a=G(),h=R("br"),l=R("br"),c=G(),u=R("div"),u.innerHTML=`<h1>Information</h1> 
    <p>Tuscarora State of Code 2022-2023 is a yearly survey to determine who codes in Tuscarora High School. None of your form submits will be sent to other companies and will be protected by Supabase RLS (Row level security)<br/>This website is maintained by Easton Snow of Tuscarora High School.<br/>Contact at <a href="mailto: classicmclive+guyot@gmail.com" class="svelte-o5metn">classicmclive@gmail.com</a></p> 
  `,_=R("br"),v=G(),p=R("button"),p.textContent="Admin",y=R("br"),m=G(),U&&U.c(),N(u,"class","info svelte-o5metn"),N(p,"class","button svelte-o5metn"),N(e,"class","svelte-o5metn")},m(b,P){I(b,e,P),Et(t,e,null),$(e,r),z.m(e,null),$(e,i),$(e,s),$(e,o);for(let C=0;C<j.length;C+=1)j[C].m(e,null);$(e,a),$(e,h),$(e,l),$(e,c),$(e,u),$(e,_),$(e,v),$(e,p),$(e,y),$(e,m),U&&U.m(e,null),S=!0,F||(H=he(p,"click",n[7]),F=!0)},p(b,[P]){if(J===(J=A(b))&&z?z.p(b,P):(z.d(1),z=J(b),z&&(z.c(),z.m(e,i))),P&1){Q=b[0];let C;for(C=0;C<Q.length;C+=1){const se=ft(b,Q,C);j[C]?j[C].p(se,P):(j[C]=_t(se),j[C].c(),j[C].m(e,a))}for(;C<j.length;C+=1)j[C].d(1);j.length=Q.length}b[5]=="bunsesIsCool!"?U?U.p(b,P):(U=mt(),U.c(),U.m(e,null)):U&&(U.d(1),U=null)},i(b){S||(Tt(t.$$.fragment,b),S=!0)},o(b){Kt(t.$$.fragment,b),S=!1},d(b){b&&x(e),Ot(t),z.d(),Ft(j,b),U&&U.d(),F=!1,H()}}}function Lt(n,e,t){const r=new Date;r.setTime(r.getTime()+t*24*60*60*1e3);let i="expires="+r.toUTCString();document.cookie=n+"="+e+";"+i+";path=/"}function oi(n){let e=n+"=",r=decodeURIComponent(document.cookie).split(";");for(let i=0;i<r.length;i++){let s=r[i];for(;s.charAt(0)==" ";)s=s.substring(1);if(s.indexOf(e)==0)return s.substring(e.length,s.length)}return""}function ai(n){return prompt(n.toString())}function li(n){return n%2}function ci(){Lt("fin",!1,-1)}function hi(n,e,t){let r=[];zt(async()=>{let{data:p,error:y}=await He.from("tsoc").select("*");t(0,r=p)});let i="",s="",o="",a=!1,h="";oi("fin")!=""&&(a=!0);async function l(){try{if(i!=""&&s!=""&&o!=""){const{data:p,error:y}=await He.from("tsoc").insert([{firstName:i,language:s,learned:o}]);t(4,a=!0),await He.from("tsoc").select("*"),Lt("fin",!0,365),t(0,r=p)}else alert("You have to input your answers!")}catch(p){console.log(p)}}function c(){t(5,h=ai("Enter admin password")),h=="bunsesIsCool!"?alert("Active"):alert("Password incorrect")}function u(){i=this.value,t(1,i)}function _(){s=this.value,t(2,s)}function v(){o=this.value,t(3,o)}return[r,i,s,o,a,h,l,c,u,_,v]}class ui extends $t{constructor(e){super(),kt(this,e,hi,si,bt,{})}}new ui({target:document.getElementById("app")});
